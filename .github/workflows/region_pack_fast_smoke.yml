name: region_pack_fast_smoke

on:
  workflow_dispatch: {}
  schedule:
    # Twice a week (UTC)
    - cron: "41 4 * * 2,5"

concurrency:
  group: region-pack-fast-${{ github.ref }}
  cancel-in-progress: true

jobs:
  region_fast:
    runs-on: ubuntu-latest
    timeout-minutes: 20

    env:
      MPLBACKEND: Agg
      PYTHONHASHSEED: "0"

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Region pack fast (GalaxyCandidates)
        run: |
          mkdir -p results/region_pack_fast
          python tools/run_regions_fast.py             --kind galaxy_candidates             --inputs data/region_pack/raw/GalaxyCandidates_022411-022698.csv.gz             --out results/region_pack_fast/galaxy_candidates             --max-regions 1             --max-rows 1200

      - name: Region pack fast (VariSummary)
        run: |
          python tools/run_regions_fast.py             --kind vari_summary             --inputs data/region_pack/raw/VariSummary_022159-022410.csv.gz             --out results/region_pack_fast/vari_summary             --max-regions 1             --max-rows 1200

      - name: Upload artefacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: region_pack_fast_results
          path: results/region_pack_fast
          if-no-files-found: error
